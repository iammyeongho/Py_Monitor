<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>대시보드 | PyMonitor</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/frontend/style/main.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
</head>
<body>
  <!-- 헤더 -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">PyMonitor</a>
      <nav class="nav">
        <a href="index.html" class="nav-link active">대시보드</a>
        <a href="project.html" class="nav-link">프로젝트 등록</a>
        <a href="tools.html" class="nav-link">도구</a>
      </nav>
      <div class="user-actions">
        <span class="user-name" id="user-name"></span>
        <button class="btn btn-secondary btn-sm" id="logout-btn">로그아웃</button>
      </div>
    </div>
  </header>

  <!-- 메인 컨텐츠 -->
  <main class="main-content">
    <div class="container">
      <!-- 페이지 타이틀 -->
      <div class="page-header">
        <h1 class="page-title">모니터링 대시보드</h1>
        <a href="project.html" class="btn btn-primary">
          <span>+</span> 프로젝트 등록
        </a>
      </div>

      <!-- 통계 카드 -->
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
          <div class="stat-label">전체 프로젝트</div>
          <div class="stat-value" id="stat-total">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">정상 운영</div>
          <div class="stat-value stat-success" id="stat-online">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">오류 발생</div>
          <div class="stat-value stat-error" id="stat-offline">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">평균 응답시간</div>
          <div class="stat-value" id="stat-response">-</div>
        </div>
      </div>

      <!-- 스케줄러 컨트롤 -->
      <div class="scheduler-control" id="scheduler-control">
        <div class="scheduler-status">
          <div class="scheduler-indicator" id="scheduler-indicator"></div>
          <span class="scheduler-label" id="scheduler-label">스케줄러 상태 확인 중...</span>
          <span class="scheduler-count" id="scheduler-count"></span>
        </div>
        <div class="scheduler-actions">
          <button class="btn btn-sm btn-primary" id="scheduler-start-btn" style="display: none;">스케줄러 시작</button>
          <button class="btn btn-sm btn-secondary" id="scheduler-stop-btn" style="display: none;">스케줄러 중지</button>
          <button class="btn btn-sm btn-secondary" id="scheduler-refresh-btn">새로고침</button>
        </div>
      </div>

      <!-- 대시보드 차트 섹션 -->
      <div class="charts-section" id="charts-section">
        <div class="section-header">
          <h2 class="section-title">모니터링 현황</h2>
          <div class="chart-period-selector">
            <button class="chart-period-btn active" data-hours="6">6시간</button>
            <button class="chart-period-btn" data-hours="24">24시간</button>
            <button class="chart-period-btn" data-hours="72">3일</button>
            <button class="chart-period-btn" data-hours="168">7일</button>
          </div>
        </div>
        <div class="charts-grid">
          <div class="chart-card">
            <h3 class="chart-title">응답 시간 (ms)</h3>
            <div class="chart-container">
              <canvas id="response-time-chart"></canvas>
            </div>
            <div class="chart-legend" id="response-time-legend"></div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">가용성 (%)</h3>
            <div class="chart-container">
              <canvas id="availability-chart"></canvas>
            </div>
            <div class="chart-stats" id="availability-stats"></div>
          </div>
        </div>
      </div>

      <!-- 프로젝트 그리드 -->
      <div class="section-header">
        <h2 class="section-title">내 프로젝트</h2>
      </div>

      <div class="projects-grid" id="projects-grid">
        <!-- 로딩 상태 -->
        <div class="loading" id="loading">
          <div class="loading-spinner"></div>
          <p>프로젝트를 불러오는 중...</p>
        </div>
      </div>

      <!-- 빈 상태 (프로젝트 없을 때) -->
      <div class="empty-state" id="empty-state" style="display: none;">
        <div class="empty-icon">📊</div>
        <h3 class="empty-title">등록된 프로젝트가 없습니다</h3>
        <p class="empty-description">새 프로젝트를 등록하고 웹사이트 모니터링을 시작하세요.</p>
        <a href="project.html" class="btn btn-primary">프로젝트 등록하기</a>
      </div>
    </div>
  </main>

  <!-- 설정 모달 -->
  <div class="modal" id="setting-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">모니터링 설정</h3>
        <button type="button" class="modal-close" id="close-setting-modal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="setting-form">
          <div class="form-group">
            <label class="form-label" for="check-interval">체크 주기 (초)</label>
            <input type="number" class="form-input" id="check-interval" min="10" value="300" required>
            <span class="form-hint">최소 10초 이상</span>
          </div>
          <div class="form-group">
            <label class="form-label" for="timeout">타임아웃 (초)</label>
            <input type="number" class="form-input" id="timeout" min="1" value="30" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="retry-count">재시도 횟수</label>
            <input type="number" class="form-input" id="retry-count" min="0" value="3" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="alert-threshold">알림 임계값</label>
            <input type="number" class="form-input" id="alert-threshold" min="1" value="3" required>
            <span class="form-hint">연속 실패 횟수</span>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="cancel-setting">취소</button>
            <button type="submit" class="btn btn-primary">저장</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 상세 정보 모달 -->
  <div class="modal" id="detail-modal">
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h3 class="modal-title" id="detail-title">프로젝트 상세</h3>
        <button type="button" class="modal-close" id="close-detail-modal">&times;</button>
      </div>

      <!-- 모달 탭 -->
      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="detail-info">정보</button>
        <button class="modal-tab" data-tab="detail-history">히스토리</button>
        <button class="modal-tab" data-tab="detail-settings">설정</button>
      </div>

      <div class="modal-body">
        <!-- 정보 탭 -->
        <div class="modal-tab-content active" id="tab-detail-info">
        <!-- 기본 정보 -->
        <div class="detail-section">
          <h4 class="detail-section-title">기본 정보</h4>
          <div class="detail-row">
            <span class="detail-label">URL</span>
            <span class="detail-value" id="detail-url">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">상태</span>
            <span class="detail-value" id="detail-status">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">응답 시간</span>
            <span class="detail-value" id="detail-response-time">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">마지막 체크</span>
            <span class="detail-value" id="detail-last-check">-</span>
          </div>
        </div>

        <!-- SSL 정보 -->
        <div class="detail-section">
          <h4 class="detail-section-title">SSL 인증서</h4>
          <div class="detail-row">
            <span class="detail-label">SSL 상태</span>
            <span class="detail-value" id="detail-ssl-status">-</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">만료일</span>
            <span class="detail-value" id="detail-ssl-expiry">-</span>
          </div>
        </div>

        <!-- 도메인 정보 -->
        <div class="detail-section">
          <h4 class="detail-section-title">도메인</h4>
          <div class="detail-row">
            <span class="detail-label">도메인 만료일</span>
            <span class="detail-value" id="detail-domain-expiry">-</span>
          </div>
        </div>

        <!-- 심층 모니터링 (Playwright) -->
        <div class="detail-section" id="deep-monitoring-section">
          <h4 class="detail-section-title">
            심층 모니터링
            <button type="button" class="btn btn-sm btn-secondary" id="run-deep-check-btn" style="margin-left: 10px; font-size: 11px;">
              심층 체크 실행
            </button>
          </h4>

          <!-- 페이지 건강 상태 -->
          <div class="detail-subsection">
            <h5 class="detail-subsection-title">페이지 건강 상태</h5>
            <div class="detail-row">
              <span class="detail-label">DOM 로드</span>
              <span class="detail-value" id="detail-dom-ready">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">JS 상태</span>
              <span class="detail-value" id="detail-js-healthy">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">JS 에러</span>
              <span class="detail-value" id="detail-js-errors">-</span>
            </div>
          </div>

          <!-- 성능 메트릭 -->
          <div class="detail-subsection">
            <h5 class="detail-subsection-title">성능 메트릭</h5>
            <div class="metrics-grid">
              <div class="metric-card">
                <div class="metric-label">TTFB</div>
                <div class="metric-value" id="detail-ttfb">-</div>
                <div class="metric-hint">첫 바이트 응답</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">DOM 로드</div>
                <div class="metric-value" id="detail-dom-load-time">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">페이지 로드</div>
                <div class="metric-value" id="detail-page-load-time">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">FCP</div>
                <div class="metric-value" id="detail-fcp">-</div>
                <div class="metric-hint">첫 콘텐츠 표시</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">LCP</div>
                <div class="metric-value" id="detail-lcp">-</div>
                <div class="metric-hint">최대 콘텐츠 표시</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">CLS</div>
                <div class="metric-value" id="detail-cls">-</div>
                <div class="metric-hint">레이아웃 변경</div>
              </div>
            </div>
          </div>

          <!-- 리소스 & 네트워크 정보 -->
          <div class="detail-subsection">
            <h5 class="detail-subsection-title">리소스 & 네트워크</h5>
            <div class="metrics-grid metrics-grid-small">
              <div class="metric-card">
                <div class="metric-label">로드된 리소스</div>
                <div class="metric-value" id="detail-resource-count">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">실패한 리소스</div>
                <div class="metric-value" id="detail-failed-resources">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">리다이렉트</div>
                <div class="metric-value" id="detail-redirect-count">-</div>
              </div>
              <div class="metric-card">
                <div class="metric-label">JS 메모리</div>
                <div class="metric-value" id="detail-js-heap">-</div>
              </div>
            </div>
          </div>
        </div>
        </div><!-- end tab-detail-info -->

        <!-- 히스토리 탭 -->
        <div class="modal-tab-content" id="tab-detail-history">
          <div class="detail-section">
            <h4 class="detail-section-title">모니터링 히스토리</h4>
            <div class="history-list" id="history-list">
              <div class="loading">
                <div class="loading-spinner"></div>
                <p>로딩 중...</p>
              </div>
            </div>
          </div>
        </div><!-- end tab-detail-history -->

        <!-- 설정 탭 -->
        <div class="modal-tab-content" id="tab-detail-settings">
        <!-- 모니터링 설정 -->
        <div class="detail-section">
          <h4 class="detail-section-title">모니터링 설정</h4>
          <form id="detail-setting-form">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="detail-check-interval">체크 주기 (초)</label>
                <input type="number" class="form-input" id="detail-check-interval" min="10" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="detail-timeout">타임아웃 (초)</label>
                <input type="number" class="form-input" id="detail-timeout" min="1" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="detail-retry-count">재시도 횟수</label>
                <input type="number" class="form-input" id="detail-retry-count" min="0" required>
              </div>
              <div class="form-group">
                <label class="form-label" for="detail-alert-threshold">알림 임계값</label>
                <input type="number" class="form-input" id="detail-alert-threshold" min="1" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="detail-response-limit">응답 속도 제한 (초)</label>
                <input type="number" class="form-input" id="detail-response-limit" min="1" value="5">
              </div>
              <div class="form-group">
                <label class="form-label" for="detail-expiry-dday">만료일 알림 (D-day)</label>
                <input type="number" class="form-input" id="detail-expiry-dday" min="1" value="30">
              </div>
            </div>

            <!-- 알림 설정 -->
            <div class="form-section-divider"></div>
            <h5 class="form-subsection-title">알림 설정</h5>

            <div class="form-group">
              <label class="form-label form-checkbox">
                <input type="checkbox" id="detail-alert-enabled" checked>
                <span>알림 활성화</span>
              </label>
            </div>

            <div class="form-group">
              <label class="form-label" for="detail-alert-email">알림 이메일</label>
              <input type="email" class="form-input" id="detail-alert-email" placeholder="alert@example.com">
              <span class="form-hint">장애 발생 시 알림을 받을 이메일</span>
            </div>

            <div class="form-group">
              <label class="form-label" for="detail-webhook-url">웹훅 URL</label>
              <input type="url" class="form-input" id="detail-webhook-url" placeholder="https://hooks.slack.com/...">
              <span class="form-hint">Slack, Discord 등 웹훅 URL</span>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-danger" id="delete-project-btn">프로젝트 삭제</button>
              <button type="submit" class="btn btn-primary">설정 저장</button>
            </div>
          </form>
        </div>
        </div><!-- end tab-detail-settings -->
      </div>
    </div>
  </div>

  <!-- 토스트 알림 컨테이너 -->
  <div class="toast-container" id="toast-container"></div>

  <!-- JavaScript - Core -->
  <script src="/frontend/js/core/utils.js"></script>
  <script src="/frontend/js/auth.js"></script>
  <script src="/frontend/js/project.js"></script>
  <script src="/frontend/js/monitoring.js"></script>

  <!-- JavaScript - Components -->
  <script src="/frontend/js/components/toast.js"></script>
  <script src="/frontend/js/components/modal.js"></script>
  <script src="/frontend/js/components/scheduler.js"></script>
  <script src="/frontend/js/components/chart.js"></script>

  <!-- JavaScript - Page -->
  <script src="/frontend/js/pages/dashboard.js"></script>
</body>
</html>
